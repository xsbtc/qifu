
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenBless - 禅意祈福</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #fdfaf6;
            margin: 0;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }
        .zen-gradient {
            background: linear-gradient(180deg, #fdfaf6 0%, #f7f1e3 100%);
        }
        /* 紧凑布局微调 */
        .main-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #e7e5e4; border-radius: 10px; }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom": "https://esm.sh/react-dom@19.0.0",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.460.0"
      }
    }
    </script>
</head>
<body class="zen-gradient">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
          Heart, 
          Sparkles, 
          History, 
          ScrollText, 
          ChevronLeft, 
          ChevronRight 
        } from 'lucide-react';

        const BASE_OBJ_URL = 'https://gnfd-testnet-sp1.nodereal.io/view/vibe/qifu/obj/';
        const BASE_TRIBUTE_URL = 'https://gnfd-testnet-sp1.nodereal.io/view/vibe/qifu/tribute/';

        const DEITIES = [
          { id: '1', name: '观世音菩萨', domain: '守护健康', imageUrl: `${BASE_OBJ_URL}1.png` },
          { id: '2', name: '财神爷', domain: '招财进宝', imageUrl: `${BASE_OBJ_URL}2.png` },
          { id: '3', name: '月下老人', domain: '琴瑟和谐', imageUrl: `${BASE_OBJ_URL}3.png` },
          { id: '4', name: '文曲星君', domain: '金榜题名', imageUrl: `${BASE_OBJ_URL}4.png` },
          { id: '5', name: '天后妈祖', domain: '出入平安', imageUrl: `${BASE_OBJ_URL}5.png` },
          { id: '6', name: '关圣帝君', domain: '义薄云天', imageUrl: `${BASE_OBJ_URL}6.png` }
        ];

        const OFFERINGS = [
          { id: '1', name: '时令水果', imageUrl: `${BASE_TRIBUTE_URL}1.png` },
          { id: '2', name: '清雅鲜花', imageUrl: `${BASE_TRIBUTE_URL}2.png` },
          { id: '3', name: '三炷清香', imageUrl: `${BASE_TRIBUTE_URL}3.png` }
        ];

        function App() {
          const [selectedDeity, setSelectedDeity] = useState(DEITIES[0]);
          const [selectedOffering, setSelectedOffering] = useState(null);
          const [blessingText, setBlessingText] = useState('');
          const [history, setHistory] = useState([]);
          const [isSubmitting, setIsSubmitting] = useState(false);
          const [carouselIndex, setCarouselIndex] = useState(0);

          useEffect(() => {
            const saved = localStorage.getItem('blessing_history');
            if (saved) {
              try { setHistory(JSON.parse(saved)); } catch (e) { console.error(e); }
            }
          }, []);

          useEffect(() => {
            setSelectedDeity(DEITIES[carouselIndex]);
          }, [carouselIndex]);

          const moveCarousel = (dir) => {
            if (dir === 'left') setCarouselIndex(prev => (prev > 0 ? prev - 1 : DEITIES.length - 1));
            else setCarouselIndex(prev => (prev < DEITIES.length - 1 ? prev + 1 : 0));
          };

          const handleSubmit = (e) => {
            e.preventDefault();
            if (!selectedOffering || !blessingText.trim()) {
              alert("请选择供品并填写祈福内容。");
              return;
            }
            setIsSubmitting(true);
            const newRecord = {
              id: Date.now().toString(),
              time: new Date().toLocaleString('zh-CN', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }),
              deityName: selectedDeity.name,
              offeringName: selectedOffering.name,
              content: blessingText
            };
            setTimeout(() => {
              const updated = [newRecord, ...history];
              setHistory(updated);
              localStorage.setItem('blessing_history', JSON.stringify(updated));
              setBlessingText('');
              setSelectedOffering(null);
              setIsSubmitting(false);
            }, 1000);
          };

          const el = React.createElement;

          return el('div', { className: "max-w-3xl mx-auto px-4 min-h-screen flex flex-col justify-between" }, [
            el('div', { key: 'main-form', className: "flex-grow flex flex-col justify-center py-4" }, [
                // Header: 极简
                el('header', { key: 'h', className: "text-center mb-4" }, [
                  el('h1', { className: "text-2xl md:text-3xl font-black text-stone-800 tracking-[0.2em]" }, "禅 意 祈 福"),
                ]),

                el('form', { key: 'f', onSubmit: handleSubmit, className: "space-y-4" }, [
                  // Carousel Deity
                  el('section', { key: 's1', className: "flex flex-col items-center" }, [
                    el('div', { className: "text-xs text-stone-400 mb-2 tracking-widest flex items-center gap-1" }, [
                      el(Sparkles, { size: 12 }),
                      "请选择一位神仙"
                    ]),
                    el('div', { className: "relative w-64 md:w-72 mx-auto overflow-hidden rounded-2xl shadow-xl bg-stone-100 border-2 border-stone-200" }, [
                      el('button', { type: 'button', onClick: () => moveCarousel('left'), className: "absolute left-2 top-1/2 -translate-y-1/2 z-10 p-1.5 bg-white/80 rounded-full shadow hover:bg-white transition-colors" }, el(ChevronLeft, { size: 18 })),
                      el('button', { type: 'button', onClick: () => moveCarousel('right'), className: "absolute right-2 top-1/2 -translate-y-1/2 z-10 p-1.5 bg-white/80 rounded-full shadow hover:bg-white transition-colors" }, el(ChevronRight, { size: 18 })),
                      el('div', { 
                        className: "flex transition-transform duration-500 ease-in-out", 
                        style: { transform: `translateX(-${carouselIndex * 100}%)` } 
                      }, DEITIES.map(d => el('div', { key: d.id, className: "min-w-full relative" }, [
                        el('div', { className: "aspect-[3/3.5] overflow-hidden" }, [
                          el('img', { src: d.imageUrl, className: "w-full h-full object-cover" })
                        ]),
                        el('div', { className: "absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex flex-col justify-end p-4 text-white" }, [
                          el('h3', { className: "text-lg font-bold" }, d.name),
                          el('p', { className: "text-[10px] text-amber-200" }, d.domain)
                        ])
                      ])))
                    ])
                  ]),

                  // Offerings
                  el('section', { key: 's2', className: "flex flex-col items-center" }, [
                    el('div', { className: "text-xs text-stone-400 mb-2 tracking-widest flex items-center gap-1" }, [
                      el(Heart, { size: 12 }),
                      "请选择1个贡品"
                    ]),
                    el('div', { className: "grid grid-cols-3 gap-3 max-w-sm mx-auto" }, OFFERINGS.map(o => el('div', {
                      key: o.id,
                      onClick: () => setSelectedOffering(o),
                      className: `group relative aspect-square rounded-xl overflow-hidden cursor-pointer border-2 transition-all ${selectedOffering?.id === o.id ? 'border-amber-500 scale-105 shadow-md' : 'border-transparent bg-stone-200'}`
                    }, [
                      el('img', { src: o.imageUrl, className: "w-full h-full object-cover transition-transform group-hover:scale-110" }),
                      el('div', { className: `absolute inset-0 flex items-center justify-center bg-black/30 text-white text-[10px] font-bold transition-opacity ${selectedOffering?.id === o.id ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'}` }, o.name)
                    ])))
                  ]),

                  // Blessing Input
                  el('section', { key: 's3' }, [
                    el('textarea', {
                      value: blessingText,
                      onChange: (e) => setBlessingText(e.target.value),
                      placeholder: "书写祈福内容...",
                      className: "w-full h-24 p-4 text-base rounded-xl bg-white border border-stone-200 shadow-inner focus:outline-none focus:ring-2 focus:ring-amber-500/20 italic text-stone-600 resize-none"
                    })
                  ]),

                  // Submit
                  el('div', { key: 'btn', className: "flex justify-center" }, [
                    el('button', {
                      type: "submit",
                      disabled: isSubmitting,
                      className: `px-10 py-3 rounded-full text-lg font-bold tracking-widest transition-all ${isSubmitting ? 'bg-stone-300' : 'bg-stone-900 text-white hover:bg-amber-600 active:scale-95 shadow-lg'}`
                    }, isSubmitting ? '祈愿中...' : '提交祈福')
                  ])
                ])
            ]),

            // History Section
            el('section', { key: 'hist', className: "mt-4 pt-4 border-t border-stone-200 pb-10" }, [
              el('div', { className: "flex items-center justify-center gap-2 mb-4" }, [
                el(History, { className: "text-stone-300", size: 16 }),
                el('h2', { className: "text-sm font-bold text-stone-500 tracking-widest" }, "功 德 簿")
              ]),
              history.length === 0 ? el('p', { className: "text-center text-stone-400 text-xs italic" }, "尚无记录")
              : el('div', { className: "space-y-2 max-w-lg mx-auto overflow-y-auto max-h-48 px-2" }, history.map(r => el('div', { key: r.id, className: "bg-white p-3 rounded-lg shadow-sm border border-stone-100 text-[11px]" }, [
                el('div', { className: "flex justify-between mb-1" }, [
                  el('div', { className: "flex gap-2" }, [
                    el('span', { className: "font-bold text-stone-800" }, r.deityName),
                    el('span', { className: "text-amber-600" }, `[${r.offeringName}]`)
                  ]),
                  el('span', { className: "text-stone-300" }, r.time)
                ]),
                el('p', { className: "text-stone-500 italic" }, r.content)
              ])))
            ])
          ]);
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
